<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Social</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css', v='1.1') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta name="current-username" content="{{ username }}">
    <script src="{{ url_for('static', filename='script.js', v='1.1') }}"></script>
</head>
<body>
    <!-- Sidebar Menu -->
    <div class="sidebar">
        <button class="menu-btn">â˜° Menu</button>
        <div class="dropdown-content">
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('free_workouts') }}">Free Workouts</a>
            <a href="{{ url_for('premium_dashboard') }}">Premium Dashboard</a>
            <a href="{{ url_for('feed') }}">Social</a>
            <a href="{{ url_for('logout') }}">Logout</a>
            <span id="unread-badge" class="unread-badge hidden">0</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container feed">
        <h1>Social</h1>

        <!-- Composer -->
        <div class="composer-card">
            <form action="/post_status" method="POST" class="composer-form" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="composer-inner">
                    <div class="composer-body">
                        <input type="text" name="content" class="composer-input" placeholder="What is happening?!">
                        <div class="composer-actions">
                            <div class="file-upload-container">
                                <label for="image-upload" class="file-upload-btn">
                                    <i class="fas fa-paperclip"></i>
                                </label>
                                <input type="file" id="image-upload" name="image" accept="image/*" style="display: none;">
                                <span id="selected-file-name" class="selected-file-name"></span>
                            </div>
                            <button type="submit" class="sleek-btn small">Post</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Posts Display -->
        <div class="posts timeline">
            {% if posts %}
                {% for post in posts %}
                    <div class="post clickable-post" data-post-id="{{ post.id }}">
                        <div class="post-header"><strong>@{{ post.username }}</strong><span class="timestamp">{{ post.timestamp | format_date('%m/%d/%y %I:%M %p') }}</span></div>
                        <p>{{ post.content }}</p>
                        {% if post.image_path %}
                            <div class="post-image">
                                <img src="{{ url_for('static', filename=post.image_path) }}" alt="Post image" loading="lazy">
                            </div>
                        {% endif %}
                        <div class="post-actions">
                            <div class="reactions">
                                <button class="reaction-btn heart {{ 'active' if post.user_reaction == 'heart' }}" data-reaction="heart" aria-label="Like post"><i class="far fa-heart"></i> <span>{{ post.reactions['heart'] or 0 }}</span></button>
                                <button class="reaction-btn thumbs-up {{ 'active' if post.user_reaction == 'thumbs-up' }}" data-reaction="thumbs-up" aria-label="Thumbs up"><i class="far fa-thumbs-up"></i> <span>{{ post.reactions['thumbs-up'] or 0 }}</span></button>
                                <button class="reaction-btn thumbs-down {{ 'active' if post.user_reaction == 'thumbs-down' }}" data-reaction="thumbs-down" aria-label="Thumbs down"><i class="far fa-thumbs-down"></i> <span>{{ post.reactions['thumbs-down'] or 0 }}</span></button>
                            </div>
                            {% if post.username == session['username'] %}
                                <button class="delete-post inline-action" data-post-id="{{ post.id }}"><i class="far fa-trash-alt"></i> Delete</button>
                            {% endif %}
                        </div>
                        <!-- Reply count indicator -->
                        <div class="reply-indicator">
                            <i class="far fa-comment"></i> {{ post.replies|length }} replies
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>No posts yet. Be the first!</p>
            {% endif %}
        </div>
    </div>

    <!-- Post Modal -->
    <div id="postModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalPostContent">
                <!-- Post content will be loaded here -->
            </div>
        </div>
    </div>
</body>
</html>
